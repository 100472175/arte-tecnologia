<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="style.css" />
    <title>mi-cuerpo-es-una-nube</title>
  </head>

  <body>
    <button type="button" id="button" onclick="init()">Empezar</button>
    <div id="webcam-container"></div>
    <div id="label-container"></div>

    <div class="texto"></div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <script type="text/javascript">
      //           游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢
      const URL = "https://teachablemachine.withgoogle.com/models/8eOjIzDa1/";

      const button = document.getElementById("button");

      let model, webcam, labelContainer, maxPredictions;

      let speech_rate = 0.7;
      let speed = 5000;

      let text = `
En el bullicioso campus de la Universidad Central, 
un grupo diverso de estudiantes universitarios se 
encontraba reunido en la biblioteca, cada uno 
inmerso en sus propios proyectos y estudios. Entre 
ellos se encontraban Sof칤a, una brillante estudiante 
de ingenier칤a; Marcos, un apasionado de la literatura 
creativa; Ana, una entusiasta de las ciencias sociales; 
y Carlos, un futuro cient칤fico de renombre.'\n\n'

Un d칤a, el profesor de f칤sica anunci칩 un desaf칤o para 
los estudiantes: dise침ar y construir un dispositivo 
que pudiera ayudar a personas con discapacidades 
visuales a navegar de manera m치s segura por su 
entorno. Sof칤a, Marcos, Ana y Carlos, intrigados por 
el desaf칤o, decidieron unirse para trabajar juntos 
en el proyecto.\n\n

Con habilidades complementarias, se sumergieron en 
el trabajo colaborativo. Sof칤a aport칩 su experiencia 
en dise침o y tecnolog칤a, creando un prototipo funcional 
del dispositivo. Marcos utiliz칩 su creatividad para 
idear una interfaz de usuario intuitiva, que permitiera 
a los usuarios interactuar f치cilmente con el dispositivo. 
Ana realiz칩 investigaciones exhaustivas sobre las 
necesidades de las personas con discapacidad visual, 
asegur치ndose de que el dispositivo fuera verdaderamente 
칰til y accesible. Mientras tanto, Carlos aplic칩 sus 
conocimientos en f칤sica y electr칩nica para optimizar 
el rendimiento del dispositivo y hacerlo lo m치s 
preciso posible.\n\n

A medida que avanzaban en el proyecto, enfrentaron 
desaf칤os y obst치culos, pero siempre encontraron 
soluciones trabajando juntos. Se apoyaron mutuamente, 
compartieron ideas y habilidades, y aprendieron unos 
de otros en el proceso. La biblioteca se convirti칩 
en su lugar de reuni칩n habitual, donde intercambiaban 
ideas y debat칤an sobre c칩mo mejorar su creaci칩n.\n\n

Despu칠s de semanas de arduo trabajo, finalmente 
completaron el dispositivo. Presentaron su proyecto 
al profesor y quedaron sorprendidos por la positiva 
reacci칩n que recibieron. El dispositivo no solo 
cumpl칤a con los requisitos del desaf칤o, sino que 
tambi칠n superaba las expectativas, gracias a la 
colaboraci칩n y el esfuerzo conjunto de todos los 
miembros del equipo.\n\n

Su proyecto no solo fue un 칠xito acad칠mico, sino 
que tambi칠n tuvo un impacto real en la comunidad. 
El dispositivo ayud칩 a personas con discapacidades 
visuales a moverse con mayor seguridad y confianza 
en su entorno, demostrando el poder de la colaboraci칩n 
entre personas universitarias para generar soluciones 
innovadoras y significativas. Desde entonces, Sof칤a, 
Marcos, Ana y Carlos continuaron colaborando en 
proyectos futuros, convirti칠ndose en un equipo formidable 
unido por su pasi칩n por hacer del mundo un lugar mejor.\n\n
`;

      const div = document.querySelector(".texto");

      async function init() {
        labelContainer = document.getElementById("label-container");
        labelContainer.innerHTML = "Cargando...";
        const modelURL = URL + "model.json";
        const metadataURL = URL + "metadata.json";
        model = await tmImage.load(modelURL, metadataURL);
        maxPredictions = model.getTotalClasses();

        const flip = true;
        webcam = new tmImage.Webcam(200, 200, flip);
        await webcam.setup();
        await webcam.play();
        button.classList.add("hidden");
        labelContainer.innerHTML = "";
        window.requestAnimationFrame(loop);

        document.getElementById("webcam-container").appendChild(webcam.canvas);
        for (let i = 0; i < maxPredictions; i++) {
          labelContainer.appendChild(document.createElement("div"));
        }
      }

      async function loop() {
        webcam.update();
        await predict();
        window.requestAnimationFrame(loop);
      }

      async function predict() {
        const prediction = await model.predict(webcam.canvas);

        // 游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢游녢
        if (prediction[0].probability.toFixed(2) === "1.00") {
          speed = 200;
        } else if (prediction[1].probability.toFixed(2) === "1.00") {
          speed = 100;
        } else if (prediction[2].probability.toFixed(2) === "1.00") {
          speed = 50;
        } else if (prediction[0].probability.toFixed(2) === "1.00") {
          speed = 20;
        }
      }

      function textTypingEffect(element, text, i = 0) {
        if (i === 0) {
          element.textContent = "";
        }
        element.textContent += text[i];

        if (i === text.length - 1) {
          return;
        }

        setTimeout(() => {
          textTypingEffect(element, text, i + 1);
        }, speed);
      }

      const speech = new SpeechSynthesisUtterance(text);
      speech.lang = "es"; // Establece el idioma del texto a espa침ol
      speech.rate = speech_rate; // Ajusta la velocidad de lectura (0.5 ser칤a m치s lento, 2 ser칤a m치s r치pido)
      window.speechSynthesis.speak(speech);

      textTypingEffect(div, text);
    </script>
  </body>
</html>
